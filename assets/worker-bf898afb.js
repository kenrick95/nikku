var lt=(w,S,b)=>{if(!S.has(w))throw TypeError("Cannot "+b)};var l=(w,S,b)=>(lt(w,S,"read from private field"),b?b.call(w):S.get(w)),D=(w,S,b)=>{if(S.has(w))throw TypeError("Cannot add the same private member more than once");S instanceof WeakSet?S.add(w):S.set(w,b)},E=(w,S,b,N)=>(lt(w,S,"write to private field"),N?N.call(w,b):S.set(w,b),b);var H=(w,S,b)=>(lt(w,S,"access private method"),b);(function(){var T,y,A,G,x,W,M,R,L,z,X,yt,$,St,J,Dt,K,kt,U,ct;"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const w=Symbol("Comlink.proxy"),S=Symbol("Comlink.endpoint"),b=Symbol("Comlink.releaseProxy"),N=Symbol("Comlink.finalizer"),V=Symbol("Comlink.thrown"),ht=t=>typeof t=="object"&&t!==null||typeof t=="function",bt={canHandle:t=>ht(t)&&t[w],serialize(t){const{port1:e,port2:s}=new MessageChannel;return Z(t,e),[s,[s]]},deserialize(t){return t.start(),It(t)}},Et={canHandle:t=>ht(t)&&V in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ut=new Map([["proxy",bt],["throw",Et]]);function Tt(t,e){for(const s of t)if(e===s||s==="*"||s instanceof RegExp&&s.test(e))return!0;return!1}function Z(t,e=globalThis,s=["*"]){e.addEventListener("message",function r(a){if(!a||!a.data)return;if(!Tt(s,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:c,type:n,path:h}=Object.assign({path:[]},a.data),f=(a.data.argumentList||[]).map(P);let i;try{const u=h.slice(0,-1).reduce((d,g)=>d[g],t),p=h.reduce((d,g)=>d[g],t);switch(n){case"GET":i=p;break;case"SET":u[h.slice(-1)[0]]=P(a.data.value),i=!0;break;case"APPLY":i=p.apply(u,f);break;case"CONSTRUCT":{const d=new p(...f);i=xt(d)}break;case"ENDPOINT":{const{port1:d,port2:g}=new MessageChannel;Z(t,g),i=et(d,[d])}break;case"RELEASE":i=void 0;break;default:return}}catch(u){i={value:u,[V]:0}}Promise.resolve(i).catch(u=>({value:u,[V]:0})).then(u=>{const[p,d]=q(u);e.postMessage(Object.assign(Object.assign({},p),{id:c}),d),n==="RELEASE"&&(e.removeEventListener("message",r),ft(e),N in t&&typeof t[N]=="function"&&t[N]())}).catch(u=>{const[p,d]=q({value:new TypeError("Unserializable return value"),[V]:0});e.postMessage(Object.assign(Object.assign({},p),{id:c}),d)})}),e.start&&e.start()}function Ct(t){return t.constructor.name==="MessagePort"}function ft(t){Ct(t)&&t.close()}function It(t,e){return tt(t,[],e)}function j(t){if(t)throw new Error("Proxy has been released and is not useable")}function dt(t){return F(t,{type:"RELEASE"}).then(()=>{ft(t)})}const v=new WeakMap,Y="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(v.get(t)||0)-1;v.set(t,e),e===0&&dt(t)});function At(t,e){const s=(v.get(e)||0)+1;v.set(e,s),Y&&Y.register(t,e,t)}function Pt(t){Y&&Y.unregister(t)}function tt(t,e=[],s=function(){}){let r=!1;const a=new Proxy(s,{get(c,n){if(j(r),n===b)return()=>{Pt(a),dt(t),r=!0};if(n==="then"){if(e.length===0)return{then:()=>a};const h=F(t,{type:"GET",path:e.map(f=>f.toString())}).then(P);return h.then.bind(h)}return tt(t,[...e,n])},set(c,n,h){j(r);const[f,i]=q(h);return F(t,{type:"SET",path:[...e,n].map(u=>u.toString()),value:f},i).then(P)},apply(c,n,h){j(r);const f=e[e.length-1];if(f===S)return F(t,{type:"ENDPOINT"}).then(P);if(f==="bind")return tt(t,e.slice(0,-1));const[i,u]=pt(h);return F(t,{type:"APPLY",path:e.map(p=>p.toString()),argumentList:i},u).then(P)},construct(c,n){j(r);const[h,f]=pt(n);return F(t,{type:"CONSTRUCT",path:e.map(i=>i.toString()),argumentList:h},f).then(P)}});return At(a,t),a}function Bt(t){return Array.prototype.concat.apply([],t)}function pt(t){const e=t.map(q);return[e.map(s=>s[0]),Bt(e.map(s=>s[1]))]}const mt=new WeakMap;function et(t,e){return mt.set(t,e),t}function xt(t){return Object.assign(t,{[w]:!0})}function q(t){for(const[e,s]of ut)if(s.canHandle(t)){const[r,a]=s.serialize(t);return[{type:"HANDLER",name:e,value:r},a]}return[{type:"RAW",value:t},mt.get(t)||[]]}function P(t){switch(t.type){case"HANDLER":return ut.get(t.name).deserialize(t.value);case"RAW":return t.value}}function F(t,e,s){return new Promise(r=>{const a=Mt();t.addEventListener("message",function c(n){!n.data||!n.data.id||n.data.id!==a||(t.removeEventListener("message",c),r(n.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:a},e),s)})}function Mt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function st(t,e,s){const r=[];for(let a=e;a<e+s;a++)r.push(t[a]);return r}const _={LITTLE:0,BIG:1};function Rt(t){const e=st(t,4,2);return e[0]===255&&e[1]===254?_.LITTLE:_.BIG}function Lt(t,e,s,r=_.BIG){const a=st(t,e,s);return r===_.LITTLE&&a.reverse(),String.fromCharCode(...a)}function o(t,e,s,r=_.BIG){const a=st(t,e,s);return r===_.LITTLE&&a.reverse(),a.reduce((c,n)=>c*256+n,0)}function nt(t,e,s){return t<=e?e:t>=s?s:t}function B(t){return t>=32768?t-65536:t}class zt{constructor(e){D(this,X);D(this,$);D(this,J);D(this,K);D(this,U);D(this,T,void 0);D(this,y,void 0);D(this,A,void 0);D(this,G,void 0);D(this,x,void 0);D(this,W,void 0);D(this,M,void 0);D(this,R,void 0);D(this,L,void 0);D(this,z,void 0);if(E(this,M,null),E(this,R,null),E(this,L,null),E(this,z,[]),this.rawData=new Uint8Array(e),Lt(this.rawData,0,4)!=="RSTM")throw new Error("Not a valid BRSTM file");this.endianness=Rt(this.rawData),E(this,T,o(this.rawData,16,4,this.endianness)),E(this,y,l(this,T)+o(this.rawData,l(this,T)+12,4,this.endianness)+8),E(this,A,l(this,T)+o(this.rawData,l(this,T)+20,4,this.endianness)+8),E(this,G,l(this,T)+o(this.rawData,l(this,T)+28,4,this.endianness)+8),E(this,x,o(this.rawData,24,4,this.endianness)),E(this,W,o(this.rawData,32,4,this.endianness)),this.metadata=H(this,$,St).call(this)}getAllSamples(){if(l(this,M))return l(this,M);const{numberChannels:e,totalSamples:s,totalBlocks:r,samplesPerBlock:a}=this.metadata,c=[];for(let n=0;n<e;n++)c.push(new Int16Array(s));for(let n=0;n<r;n++){const h=H(this,U,ct).call(this,n);for(let f=0;f<e;f++)c[f].set(h[f],n*a)}return E(this,M,c),c}getBuffer(e,s){return this.getSamples(e,s)}getSamples(e,s){const{numberChannels:r,totalBlocks:a,totalSamples:c,samplesPerBlock:n}=this.metadata,h=Math.max(0,e),f=Math.min(c,e+s),i=Math.max(0,Math.floor(h/n)),u=Math.min(a-1,Math.floor(f/n)),p=[];for(let g=i;g<=u;g++)p.push(H(this,U,ct).call(this,g));const d=[];for(let g=0;g<r;g++)d.push(new Int16Array(f-h));for(let g=i;g<=u;g++){const C=g-i;if(g===i&&g===u)for(let m=0;m<r;m++)d[m].set(p[C][m].slice(h-i*n,h-i*n+s),0);else if(g===i)for(let m=0;m<r;m++){const k=p[C][m].slice(h-i*n);d[m].set(k,0)}else if(g===u)for(let m=0;m<r;m++){const k=p[C][m].slice(0,f-p[C][m].length-i*n);k.length+(g*n-h)>d[m].length?d[m].set(k.slice(0,s-(g*n-h)),g*n-h):d[m].set(k,g*n-h)}else for(let m=0;m<r;m++)d[m].set(p[C][m],g*n-h)}return d}}T=new WeakMap,y=new WeakMap,A=new WeakMap,G=new WeakMap,x=new WeakMap,W=new WeakMap,M=new WeakMap,R=new WeakMap,L=new WeakMap,z=new WeakMap,X=new WeakSet,yt=function(){if(l(this,L))return l(this,L);const{numberChannels:e}=this.metadata,s=[];for(let r=0;r<e;r++){const a=l(this,T)+o(this.rawData,l(this,G)+8+r*8,4,this.endianness)+8+8,c=[];for(let n=0;n<16;n++){const h=o(this.rawData,a+2*n,2,this.endianness);c.push(B(h))}s.push({adpcmCoefficients:c,gain:o(this.rawData,a+40,2,this.endianness),initialPredictorScale:o(this.rawData,a+42,2,this.endianness),historySample1:o(this.rawData,a+44,2,this.endianness),historySample2:o(this.rawData,a+46,2,this.endianness),loopPredictorScale:o(this.rawData,a+48,2,this.endianness),loopHistorySample1:o(this.rawData,a+50,2,this.endianness),loopHistorySample2:o(this.rawData,a+52,2,this.endianness)})}return E(this,L,s),s},$=new WeakSet,St=function(){const e=o(this.rawData,l(this,y)+2,1,this.endianness),s=o(this.rawData,l(this,A),1,this.endianness),r=o(this.rawData,l(this,A)+1,1,this.endianness),a=[];for(let n=0;n<s;n++){const h=l(this,T)+8+o(this.rawData,l(this,A)+4+n*8+4,4,this.endianness),f=o(this.rawData,l(this,A)+4+n*8+1,1,this.endianness);let i=0;f===0?i=o(this.rawData,h,1,this.endianness):f===1&&(i=o(this.rawData,h+8,1,this.endianness)),a.push({numberChannels:i,type:f})}const c={fileSize:o(this.rawData,8,4,this.endianness),endianness:this.endianness,codec:o(this.rawData,l(this,y),1,this.endianness),loopFlag:o(this.rawData,l(this,y)+1,1,this.endianness),numberChannels:e,sampleRate:o(this.rawData,l(this,y)+4,2,this.endianness),loopStartSample:o(this.rawData,l(this,y)+8,4,this.endianness),totalSamples:o(this.rawData,l(this,y)+12,4,this.endianness),totalBlocks:o(this.rawData,l(this,y)+20,4,this.endianness),blockSize:o(this.rawData,l(this,y)+24,4,this.endianness),samplesPerBlock:o(this.rawData,l(this,y)+28,4,this.endianness),finalBlockSize:o(this.rawData,l(this,y)+32,4,this.endianness),finalBlockSizeWithPadding:o(this.rawData,l(this,y)+40,4,this.endianness),totalSamplesInFinalBlock:o(this.rawData,l(this,y)+36,4,this.endianness),adpcTableSamplesPerEntry:o(this.rawData,l(this,y)+44,4,this.endianness),adpcTableBytesPerEntry:o(this.rawData,l(this,y)+48,4,this.endianness),numberTracks:s,trackDescriptionType:r,trackDescriptions:a};return c.loopStartSample>=c.totalSamples&&(c.loopFlag=0,c.loopStartSample=0,console.warn("The loop start sample in this file is invalid.")),c},J=new WeakSet,Dt=function(e){const{blockSize:s,totalBlocks:r,numberChannels:a,finalBlockSize:c,finalBlockSizeWithPadding:n}=this.metadata,h=[];for(let i=0;i<a;i++)h.push(new Uint8Array(e===r-1?c:s));let f=e;for(let i=0;i<a;i++){const u=i!==0&&f+1===r?f*a*s+i*n:(f*a+i)*s,p=f+1===r?u+c:u+s,d=this.rawData.slice(l(this,W)+32+u,l(this,W)+32+p);h[i].set(d)}return h},K=new WeakSet,kt=function(){if(l(this,R))return l(this,R);const{totalBlocks:e,numberChannels:s}=this.metadata,r=o(this.rawData,l(this,x)+4,4,this.endianness),a=this.rawData.slice(l(this,x)+8,l(this,x)+8+r);let c=0,n=0,h=0;for(let u=0;u<s;u++)n=B(o(a,c,2,this.endianness)),c+=2,h=B(o(a,c,2,this.endianness)),c+=2;const f=[];for(let u=0;u<e;u++){f.push([]);for(let p=0;p<s;p++)u>0&&(n=B(o(a,c,2,this.endianness)),c+=2,h=B(o(a,c,2,this.endianness)),c+=2),f[u].push({yn1:n,yn2:h})}let i=[];for(let u=0;u<s;u++)i.push(f.map(p=>p[u]));return E(this,R,i),i},U=new WeakSet,ct=function(e){if(l(this,z)[e])return l(this,z)[e];const{numberChannels:s,totalBlocks:r,totalSamplesInFinalBlock:a,samplesPerBlock:c,codec:n}=this.metadata,h=H(this,X,yt).call(this),f=H(this,J,Dt).call(this,e),i=H(this,K,kt).call(this),u=[],p=e===r-1?a:c;for(let d=0;d<s;d++)u.push(new Int16Array(p));for(let d=0;d<s;d++){const{adpcmCoefficients:g}=h[d],C=f[d],m=[];if(n===2){const k=C[0],{yn1:at,yn2:Ut}=i[d][e];let rt=k,Q=at,gt=Ut,it=0;for(let ot=0;ot<p;){let O=0;ot%14===0&&(rt=C[it++]),ot++&1?O=C[it++]&15:O=C[it]>>4,O>=8&&(O-=16);const Vt=1<<(rt&15),wt=rt>>4<<1;O=1024+(Vt*O<<11)+g[nt(wt,0,15)]*Q+g[nt(wt+1,0,15)]*gt>>11,gt=Q,Q=nt(O,-32768,32767),m.push(Q)}e<r-1&&(i[d][e+1].yn1=m[p-1],i[d][e+1].yn2=m[p-2])}else if(n===1)for(let k=0;k<p;k++){const at=B(o(C,k*2,2,this.endianness));m.push(at)}else if(n===0)for(let k=0;k<p;k++)m.push(B(C[k])*256);else throw new Error("Invalid codec");u[d].set(m)}return l(this,z)[e]=u,u};let I=null;function Ot(t){I=new zt(t)}function Ht(){I=null}function Nt(){if(I)return I.metadata}function Ft(){if(!I)return;const t=I.getAllSamples();return et(t,t.map(e=>e.buffer))}function _t(t,e){if(!I)return;const s=I.getSamples(t,e).map(Wt);return et(s,s.map(r=>r.buffer))}function Wt(t){const e=new Float32Array(t.length);for(let s=0;s<t.length;s++){const r=t[s];e[s]=r<0?r/32768:r/32767}return e}var Gt=Object.freeze({__proto__:null,destroy:Ht,getAllSamples:Ft,getMetadata:Nt,getSamples:_t,init:Ot});Z(Gt)})();
